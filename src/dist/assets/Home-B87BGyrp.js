import{_ as S,r as l,o as j,a as F,c as a,b as s,d as o,e as w,F as P,w as f,f as T,g as N,h as _,i as A,j as I,T as Y,k as x}from"./index-CQU0DmQk.js";import{P as $}from"./PostCard-AwN3vA5N.js";import{T as q}from"./TrendingSubblocks-dkyX5rXB.js";const z={class:"home-layout"},D={class:"main-feed"},O={class:"posts-container"},G={key:0,class:"loading-container"},J={key:0,class:"no-posts"},K={key:1,class:"posts-list"},Q={key:0,class:"infinite-loading-indicator"},R={key:1,class:"end-indicator"},W={class:"sidebar"},X={class:"welcome-card"},Z={class:"action-buttons"},tt={__name:"Home",setup(ot){const k=l(!0),c=l(!1),r=l(!0),b=l(!1);let p=null,v=null;const n=l([]),i=l(0),g=l(0),B=async()=>{try{k.value=!0;const e=await x.get(`/post/popular?page=${i.value}`);n.value=e.data.data,i.value=e.data.currentPage,g.value=e.data.totalPage,r.value=i.value<g.value-1}catch(e){console.error("获取数据失败:",e)}finally{k.value=!1}},H=async()=>{if(!(c.value||!r.value)){c.value=!0;try{const e=i.value+1,t=await x.get(`/post/popular?page=${e}`),d=t.data.data;n.value=[...n.value,...d],i.value=t.data.currentPage,g.value=t.data.totalPage,r.value=i.value<g.value-1}catch(e){console.error("加载更多数据失败:",e)}finally{c.value=!1}}},C=()=>{window.scrollTo({top:0,behavior:"smooth"})},M=()=>{if(c.value||!r.value)return;const e=window.scrollY||document.documentElement.scrollTop,t=window.innerHeight;document.documentElement.scrollHeight-e-t<200&&(v&&clearTimeout(v),v=setTimeout(()=>{H()},100))},L=()=>{const e=window.scrollY||document.documentElement.scrollTop;b.value=e>300,M()},y=()=>{p||(p=requestAnimationFrame(()=>{L(),p=null}))};j(()=>{B(),window.addEventListener("scroll",y,{passive:!0})}),F(()=>{window.removeEventListener("scroll",y),p&&cancelAnimationFrame(p),v&&clearTimeout(v)});const U=(e,t)=>{n.value[e].post=t},E=(e,t)=>{n.value[e].opinion=t},V=(e,t)=>{n.value[e].vote=t};return(e,t)=>{const d=N("router-link");return s(),a("div",z,[o("div",D,[o("div",O,[k.value?(s(),a("div",G,t[0]||(t[0]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"加载帖子中...",-1)]))):(s(),a(P,{key:1},[n.value.length===0?(s(),a("div",J,[t[2]||(t[2]=o("h2",null,"暂无帖子",-1)),t[3]||(t[3]=o("p",null,"来发布第一篇帖子吧！",-1)),w(d,{to:"/submit",class:"create-post-btn"},{default:f(()=>t[1]||(t[1]=[T(" 发布帖子 ")])),_:1})])):(s(),a("div",K,[(s(!0),a(P,null,A(n.value,(u,h)=>(s(),I($,{key:u.post.id,post:u.post,user:u.user,opinion:u.opinion,vote:u.vote,"onUpdate:post":m=>U(h,m),"onUpdate:opinion":m=>E(h,m),"onUpdate:vote":m=>V(h,m)},null,8,["post","user","opinion","vote","onUpdate:post","onUpdate:opinion","onUpdate:vote"]))),128)),r.value&&c.value?(s(),a("div",Q,t[4]||(t[4]=[o("div",{class:"loading-spinner small"},null,-1),o("span",null,"加载更多帖子...",-1)]))):_("",!0),!r.value&&n.value.length>0?(s(),a("div",R,t[5]||(t[5]=[o("span",null,"已经到底了~",-1)]))):_("",!0)]))],64))])]),o("div",W,[o("div",X,[t[8]||(t[8]=o("h2",null,"欢迎来到Postopia",-1)),t[9]||(t[9]=o("p",null,"加入社区，发表评论，并畅所欲言吧！",-1)),o("div",Z,[w(d,{to:"/submit",class:"create-post-btn"},{default:f(()=>t[6]||(t[6]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),o("path",{d:"M14 2v6h6"})],-1),T(" 发帖 ")])),_:1}),w(d,{to:"/create-space",class:"create-space-btn"},{default:f(()=>t[7]||(t[7]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("circle",{cx:"12",cy:"12",r:"3"}),o("path",{d:"M12 1v6m0 6v6"}),o("path",{d:"m21 12-6 0m-6 0-6 0"})],-1),T(" 创建空间 ")])),_:1})])]),w(q)]),w(Y,{name:"back-to-top"},{default:f(()=>[b.value?(s(),a("button",{key:0,class:"back-to-top-btn",onClick:C,"aria-label":"返回顶部"},t[10]||(t[10]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("path",{d:"m18 15-6-6-6 6"})],-1)]))):_("",!0)]),_:1})])}}},at=S(tt,[["__scopeId","data-v-04d76718"]]);export{at as default};
