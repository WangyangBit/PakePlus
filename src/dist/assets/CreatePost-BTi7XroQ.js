import{_ as N,r as o,l as C,o as $,D as q,c as n,b as r,d as s,C as S,t as c,s as g,U as I,F as j,i as z,n as _,z as F,h as k,y as U,e as T,W,p as A,B as G,L as H,V as J}from"./index-CQU0DmQk.js";const K={class:"create-post-layout"},O={class:"main-content"},Q={class:"post-form-container"},X={class:"form-group"},Y={key:0,class:"loading-spaces"},Z={key:1,class:"space-load-error"},tt={key:2,class:"select-container"},et=["value"],st={class:"post-type-tabs"},at={class:"form-group"},lt={class:"character-count"},ot={key:0,class:"form-group"},nt={key:1,class:"form-group"},rt={class:"url-validation"},it={key:0,class:"validation-error"},dt={class:"form-actions"},ut=["disabled"],vt={__name:"CreatePost",setup(ct){const P=q(),w=G(),u=o(""),b=o(""),v=o(""),i=o(""),l=o("text"),f=o(!1),V=o(null),L=a=>{b.value=a},d=o([]),p=o(!1),m=o(null),E=C(()=>!i.value||!u.value.trim()?!1:l.value==="text"?!0:l.value==="link"?x(v.value):!1),R=C(()=>[...d.value].sort((a,t)=>a.name.localeCompare(t.name))),x=a=>{try{return new URL(a),!0}catch{return!1}},B=a=>{const t=d.value.find(e=>e.name===a);return t?t.id:null},h=async()=>{p.value=!0,m.value=null,d.value=[];try{let a=0,t=1;for(;a<t;){const e=await H({page:a.toString()});if(e.data&&e.success){const{data:y,totalPage:D}=e.data;d.value=[...d.value,...y],t=D,a++}else throw new Error((e==null?void 0:e.message)||"获取空间数据失败")}}catch{}finally{p.value=!1}},M=async()=>{f.value=!0;try{const a=B(i.value);if(!a)throw new Error("无效的子版块");const t={spaceId:a,spaceName:i.value,subject:u.value.trim(),content:l.value==="text"?b.value.trim():v.value.trim()},e=await J(t);if(e&&e.success){const y={id:(e==null?void 0:e.data.toString())||Date.now().toString(),title:u.value.trim(),subblock:i.value,type:l.value};alert("帖子创建成功！"),w.push(`/r/${a}/post/${y.id}`)}else throw new Error((e==null?void 0:e.message)||"创建帖子失败")}catch(a){alert("创建帖子失败: "+(a.message||"未知错误"))}finally{f.value=!1}};return $(async()=>{await h();const a=P.query.subblock;if(a&&d.value.length>0){const t=d.value.find(e=>e.name.toLowerCase()===a.toLowerCase());t&&(i.value=t.name)}}),(a,t)=>(r(),n("div",K,[s("div",O,[s("div",Q,[t[14]||(t[14]=s("h1",{class:"form-title"},"创建新帖",-1)),s("div",X,[t[8]||(t[8]=s("label",{for:"subblock",class:"form-label"},"选择一个社区",-1)),p.value?(r(),n("div",Y,t[6]||(t[6]=[s("div",{class:"loading-spinner-sm"},null,-1),s("span",null,"加载空间列表...",-1)]))):m.value?(r(),n("div",Z,[s("span",null,c(m.value),1),s("button",{onClick:h,class:"retry-button"},"重试")])):(r(),n("div",tt,[g(s("select",{id:"subblock","onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),class:"form-select",required:""},[t[7]||(t[7]=s("option",{value:"",disabled:""},"选择一个社区",-1)),(r(!0),n(j,null,z(R.value,e=>(r(),n("option",{key:e.id,value:e.name},c(e.name)+" ("+c(e.postCount)+"篇帖子) ",9,et))),128))],512),[[I,i.value]])]))]),s("div",st,[s("button",{class:_(["post-type-tab",{active:l.value==="text"}]),onClick:t[1]||(t[1]=e=>l.value="text")},t[9]||(t[9]=[S('<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-098dbdfb><line x1="8" y1="6" x2="21" y2="6" data-v-098dbdfb></line><line x1="8" y1="12" x2="21" y2="12" data-v-098dbdfb></line><line x1="8" y1="18" x2="21" y2="18" data-v-098dbdfb></line><line x1="3" y1="6" x2="3.01" y2="6" data-v-098dbdfb></line><line x1="3" y1="12" x2="3.01" y2="12" data-v-098dbdfb></line><line x1="3" y1="18" x2="3.01" y2="18" data-v-098dbdfb></line></svg><span data-v-098dbdfb>发帖</span>',2)]),2),s("button",{class:_(["post-type-tab",{active:l.value==="link"}]),onClick:t[2]||(t[2]=e=>l.value="link")},t[10]||(t[10]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),s("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})],-1),s("span",null,"链接",-1)]),2)]),s("form",{onSubmit:F(M,["prevent"]),class:"post-form"},[s("div",at,[t[11]||(t[11]=s("label",{for:"title",class:"form-label"},"标题",-1)),g(s("input",{id:"title","onUpdate:modelValue":t[3]||(t[3]=e=>u.value=e),type:"text",placeholder:"标题",class:"form-input",maxlength:"300",required:""},null,512),[[U,u.value]]),s("div",lt,c(u.value.length)+"/300 ",1)]),l.value==="text"?(r(),n("div",ot,[t[12]||(t[12]=s("label",{for:"content",class:"form-label"},"内容（可选）",-1)),T(W,{ref_key:"editorRef",ref:V,"edit-value":b.value,onSelect:L,class:"post-editor"},null,8,["edit-value"])])):k("",!0),l.value==="link"?(r(),n("div",nt,[t[13]||(t[13]=s("label",{for:"linkUrl",class:"form-label"},"URL",-1)),g(s("input",{id:"linkUrl","onUpdate:modelValue":t[4]||(t[4]=e=>v.value=e),type:"url",placeholder:"https://example.com",class:"form-input",required:""},null,512),[[U,v.value]]),s("div",rt,[v.value&&!x(v.value)?(r(),n("span",it," 请输入正确的URL ")):k("",!0)])])):k("",!0),s("div",dt,[s("button",{type:"button",class:"cancel-btn",onClick:t[5]||(t[5]=e=>A(w).go(-1))}," 取消 "),s("button",{type:"submit",class:"submit-btn",disabled:!E.value||f.value}," 发布 ",8,ut)])],32)])]),t[15]||(t[15]=S('<div class="sidebar" data-v-098dbdfb><div class="posting-rules" data-v-098dbdfb><h3 data-v-098dbdfb>发帖须知</h3><div class="rules-content" data-v-098dbdfb><ol class="rules-list" data-v-098dbdfb><li data-v-098dbdfb>杜绝敏感政治信息</li><li data-v-098dbdfb>避免不良信息</li><li data-v-098dbdfb>保证可靠内容来源</li><li data-v-098dbdfb>遵守法律法规</li><li data-v-098dbdfb>留意阅读社区规则</li></ol><p class="rules-footer" data-v-098dbdfb> 请注意Postopia的内容政策并尊重社区指导方针 </p></div></div></div>',1))]))}},ft=N(vt,[["__scopeId","data-v-098dbdfb"]]);export{ft as default};
